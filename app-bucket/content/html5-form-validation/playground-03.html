<style>

    .pseudo-form {
        margin-top: 2rem;
        padding: 1rem 0.5rem;
        zoom: 1.2;
    }


    #console-log{
        background-color: bisque;
        margin: 0;
        margin-top: 1.5rem;

        position: relative;
        display: block ;
    }


    p {
        margin-bottom: 0.3rem;
        line-height: 110%;
    }
    

    
    .block {
        display: inline-block;
        padding-right: 2rem;
    }


    @media screen and (min-width: 800px) {
    
        .block:first-child {
            min-width: 90%;
        }

    }

    label {
        min-width:  5rem;
        text-align: right;
    }
    .control {
        display: inline-block; 
        margin-right: 2rem;    
    }
    .control:last-child {
        margin-right: 0rem;    
    }


</style>


<div class="pseudo-form">

    <div class="block">
        
        <label for="dax_erw">
            DAX erw 
        </label>

        <div class="control">
            
            <input type="number" name="dax_erw" id="dax_erw"
            min="2000"
            max="25000"
            step="1"
            data-validation_msg="Please enter a number between 2.000 and 25.000"
            value="14.5"
            > %
        </div>

    </div>

    <div class="block">

        <label for="dax_min">
            DAX Min 
        </label>
    

        <div class="control">
            <input type="number" name="dax_min" id="dax_min"
                min="2000"
                max="25000"
                step="1"
                data-validation_msg="Please enter a number between 2.000 and 25.000"
            > %
        </div>
    </div>


    <div class="block">

        <label for="dax_max">
            DAX Max
        </label>

        <div class="control">
            <input type="number" name="dax_max" id="dax_max"
                min="2000"
                max="25000"
                step="1"
                data-validation_msg="Please enter a number between 2.000 and 25.000"
            > %
        </div>
    </div>
    
    <br>
    <br>
    <br>
    
    <input  type="submit"  name="submitBtn1"  value="Input type submit" title="input[type=submit]"  accesskey="s">


</div><!-- /pseudo-form -->


    <hr>


    <p>
        Default:  &nbsp; Popups with nerdy wording and in browser language
        on submit
    </p>

   
    <p>
        <input type="checkbox" id="validateFormWithCustomBubbles" accesskey="f">
        Custom popups for invalids on <u>f</u>orm submit
    </p>

    <p>
        <input type="checkbox" id="showBubbleOnBlurOrInput">
        Custom popups for invalids already on blur
    </p>


    <div style="margin-left: 3rem; position: relative; top: -0.5rem;">

        <p>
             <input type="checkbox" id="checkOnInput">
            ... or even on every input
            
        </p>
        <p>
             <input type="checkbox" id="reclaimFocus">
            ... and lock focus
            
        </p>
    </div>





<!-- 


    <a class="link-as-button" 
    href="#" 
    onclick="configure();"
    accesskey="s"
    >Configure</a>
-->





    <div id="console-log"><div style="
            background-color: whitesmoke; 
            position: relative; 
            left: -0.8rem; top: -0.3rem; width: 10rem;" >console log</div></div>




<script>


    var logFn = console.log;  // save the original log function for later use
    var myLog = document.getElementById("console-log");
    console.log = function () {
        var line = "";
        for (var i = 0, j = arguments.length; i < j; i++) {
            if (typeof arguments[i] == "object") {
                // var argX = arguments[i];
                // var tp   = typeof argX;
                // var content = JSON.stringify(argX);
                // line += " " + tp + " " + content;
                line += " " + arguments[i];
                logFn.call(console, arguments[i]);
            } else {
                line += " " + arguments[i];
            }
        }
        if (line.length > 0) {
            myLog.innerHTML += line + "<br>";
            logFn.call(console, line); // call original function if you want to
        }
    };



    function resetAllListeners(form){

        form.oninvalid  = null;
        form.onvalid    = null;
        form.onsubmit   = null;
        
        var inputs = form.querySelectorAll("input[type=number]");
        for (var i = 0; i < inputs.length; i++) {
            var inp = inputs[i];
            inp.onvalid    = null;
            inp.onblur     = null;
            inp.onfocus    = null;
            inp.oninput    = null;
        }

    }


    function inconsistentTriplet() {

        var inp1 = document.forms.frmMain.dax_erw.value;
        var inp2 = document.forms.frmMain.dax_min.value;
        var inp3 = document.forms.frmMain.dax_max.value;
        // console.log("inp1-3: ", inp1, inp2, inp3);

        var i1 = 0
        if (inp1 != "") {
            var i1 = parseInt(inp1, 10);
        }
        var i2 = 0
        if (inp2 != "") {
            var i2 = parseInt(inp2, 10);
        }
        var i3 = 0
        if (inp3 != "") {
            var i3 = parseInt(inp3, 10);
        }
        // console.log("inp1-3 integer: ", i1, i2, i3);

        var suspicious = false;

        // expectation between extremes?
        if (i1 != 0) {
            if (i2 != 0 && i1 < i2) {
                suspicious = true;
            }

            if (i3 != 0 && i1 > i3) {
                suspicious = true;
            }
        }

        // min < max?
        if (i2 != 0 && i3 != 0 && i2 > i3) {
            suspicious = true;
        }

        return suspicious;

    }


    /* ============ UI ================  */
    

    var myForm = document.forms["frmMain"];
    var vd = new Validator(myForm);

    var configControls = [
        "checkOnInput",
        "reclaimFocus",
        "validateFormWithCustomBubbles",
        "showBubbleOnBlurOrInput",
    ];



    function  validateFormWithCustomBubblesExec() {
        nameCheck = "validateFormWithCustomBubbles"
        var checkbox = document.getElementById(nameCheck);
        if (checkbox.checked) {
            vd.validateFormWithCustomBubbles();
        }
        // console.log(`checkbox ${nameCheck} executed`)
    }

    function  showBubbleOnBlurOrInputExec() {
        nameCheck = "showBubbleOnBlurOrInput"
        var checkbox = document.getElementById(nameCheck);
        if (checkbox.checked) {
            vd.showBubbleOnBlurOrInput();
            console.log(`checkbox ${nameCheck} executed`)
        }
    }

        function checkOnInputExec() {
            nameCheck = "checkOnInput"
            var checkbox = document.getElementById(nameCheck);
            if (checkbox.checked) {
                vd.SetCheckOnInput(true);
            } else {
                vd.SetCheckOnInput(false);
            }
            // console.log(`checkbox ${nameCheck} executed`)
        }
        function reclaimFocusExec() {
            nameCheck = "reclaimFocus"
            var checkbox = document.getElementById(nameCheck);
            if (checkbox.checked) {
                vd.SetReclaimFocus(true);
            } else {
                vd.SetReclaimFocus(false);
            }
            // console.log(`checkbox ${nameCheck} executed`)
        }
    


    function configure(initial){

        // load config
        if (initial !== undefined) {
            for (let i = 0; i < configControls.length; i++) {
                var chkName = configControls[i];
                var wasChecked = window.localStorage.getItem(chkName);
                if (wasChecked === "true") {
                    document.getElementById(chkName).checked = wasChecked;
                }
            }
        }


        resetAllListeners(myForm);

          checkOnInputExec();
          reclaimFocusExec();
        validateFormWithCustomBubblesExec();
        showBubbleOnBlurOrInputExec();


        // save config
        for (let i = 0; i < configControls.length; i++) {
            var chkName = configControls[i];
            var chk = document.getElementById(chkName);
            window.localStorage.setItem(chkName, chk.checked);
        }

        myForm.addEventListener(
            "submit",
            function (event) {
                var yes = inconsistentTriplet();
                if (yes) {
                    console.log("inconsistentTriplet()", yes);
                    var el = document.forms.frmMain.dax_max;
                    vd.ShowBubblePopup(el, "Please adjust expected DAX between Min and Max",true);
                    event.preventDefault();
                }
            },
            false
        );

        console.log("validation configured");
    }

    

    // on form load - configure()
    // then add event listeners to checkbox.change
    document.addEventListener(
        'DOMContentLoaded',
        function () {
            
            myForm.method = "GET";
            myForm.action = "/{{AppPrefix}}/doc/html5-form-validation/playground-03.html";
            
            configure(true);

            var checkboxes = document.querySelectorAll('input[type=checkbox]');
            for (var checkbox of checkboxes) {
                checkbox.addEventListener('change', function (event) {
                    if (event.target.checked) {
                    }
                    configure();
                });
            }

        },
        false
    );





</script>



